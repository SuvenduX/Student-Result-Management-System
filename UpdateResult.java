/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package GUI;

import ConnectionProvider.ConnectionProviderCode;
import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;
import javax.swing.JOptionPane;
import net.proteanit.sql.DbUtils;

/**
 *
 * @author Avita
 */
public class UpdateResult extends javax.swing.JFrame {

    /**
     * Creates new form UpdateResult
     */
    public UpdateResult() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        RollNo_TextField = new javax.swing.JTextField();
        Search_Button = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        Physics_TextField = new javax.swing.JTextField();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        Maths_TextField = new javax.swing.JTextField();
        Chemistry_TextField = new javax.swing.JTextField();
        Electrical_TextField = new javax.swing.JTextField();
        Biology_TextField = new javax.swing.JTextField();
        Submit_Button = new javax.swing.JButton();
        Exit_Button = new javax.swing.JButton();
        jLabel7 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setMaximumSize(new java.awt.Dimension(550, 420));
        setMinimumSize(new java.awt.Dimension(550, 420));
        setPreferredSize(new java.awt.Dimension(550, 420));
        getContentPane().setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setText("Roll No");
        getContentPane().add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 40, -1, -1));

        RollNo_TextField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RollNo_TextFieldActionPerformed(evt);
            }
        });
        getContentPane().add(RollNo_TextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 40, 170, -1));

        Search_Button.setText("Search");
        Search_Button.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Search_ButtonActionPerformed(evt);
            }
        });
        getContentPane().add(Search_Button, new org.netbeans.lib.awtextra.AbsoluteConstraints(400, 40, -1, -1));

        jLabel2.setText("Physics");
        getContentPane().add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 100, -1, -1));
        getContentPane().add(Physics_TextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 100, 170, -1));

        jLabel3.setText("Maths");
        getContentPane().add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 150, -1, -1));

        jLabel4.setText("Chemistry");
        getContentPane().add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 200, -1, -1));

        jLabel5.setText("Electrical");
        getContentPane().add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 250, -1, -1));

        jLabel6.setText("Biology");
        getContentPane().add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 300, -1, -1));
        getContentPane().add(Maths_TextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 150, 170, -1));
        getContentPane().add(Chemistry_TextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 200, 170, -1));
        getContentPane().add(Electrical_TextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 250, 170, -1));
        getContentPane().add(Biology_TextField, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 300, 170, -1));

        Submit_Button.setText("Submit");
        Submit_Button.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Submit_ButtonActionPerformed(evt);
            }
        });
        getContentPane().add(Submit_Button, new org.netbeans.lib.awtextra.AbsoluteConstraints(110, 350, -1, -1));

        Exit_Button.setText("Exit");
        Exit_Button.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Exit_ButtonActionPerformed(evt);
            }
        });
        getContentPane().add(Exit_Button, new org.netbeans.lib.awtextra.AbsoluteConstraints(300, 350, -1, -1));

        jLabel7.setIcon(new javax.swing.ImageIcon(getClass().getResource("/GUI/schoolPic2.png"))); // NOI18N
        jLabel7.setText("jLabel7");
        getContentPane().add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(-30, -210, -1, -1));

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void RollNo_TextFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RollNo_TextFieldActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_RollNo_TextFieldActionPerformed

    private void Search_ButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Search_ButtonActionPerformed
       
          String rollNo = RollNo_TextField.getText();
         
        try{
            Connection con = ConnectionProviderCode.getcon();
            
            //resultSet is an object which holds the table of  data when we run a query on database.Assume it stores the output of query select* from table
            //ResultSet.Type_Scrl_Snstv : parameter updates if any changes in the DB are refelected in ResultSet after running the command 
            //ResultSet.concur_updatable : this paramater allows to update the content of ResultSet object  
            Statement st = con.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE);
            
            ResultSet rs = st.executeQuery("SELECT * FROM result WHERE rollNo='"+rollNo+"'"); //checking if the entered rollNo is presentin DB or not
           
            
            if(!rs.first()){  // resultSet.first() method points to the first row of ResultSet object . If row exists returns true. Here if the row of
                                    // given roll no doesnt exist return false & !false=true and execute the code, message pops up
                JOptionPane.showMessageDialog(null, "Entered Roll No. doesn't exist");
            }
            else{  
                RollNo_TextField.setEditable(false); //if the 'roll No' already exist , then make rollNo text fied non editable during updating marks 
               
               //As the roll no exist , we need to auto populate all subject marks. Now we are fetching the marks from resultSet(rs) object & displaying in frame
               //Once the roll no exists,all the table row data stored such way : rs={roll no,physics marks,math marks,chem mark,elec mark,bio mark};
                Physics_TextField.setText(rs.getString(2));  // 2 bcs the index of physics is 2 //1 based indexing
                Maths_TextField.setText(rs.getString(3));    //3 bcs the index of maths is 3 //1 basd indexing
                Chemistry_TextField.setText(rs.getString(4));
                 Electrical_TextField.setText(rs.getString(5));
                 Biology_TextField.setText(rs.getString(6));
                
            }
        }
        catch(Exception e){
            JOptionPane.showMessageDialog(null, e.toString());
        }
        
    }//GEN-LAST:event_Search_ButtonActionPerformed

    //SUBMIT BUTTON
    private void Submit_ButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Submit_ButtonActionPerformed
        
        
        String rollNo = RollNo_TextField.getText();  //String object rollNo to store the user given roll no
        
       // Now we are storing all the marks as Integer which are given by the user as we need to have sum later .so typecast the string input to int 
        int physicsMarks = Integer.parseInt(Physics_TextField.getText()); 
        int mathsMarks = Integer.parseInt(Maths_TextField.getText());
        int chemMarks = Integer.parseInt(Chemistry_TextField.getText());
        int electricalMarks = Integer.parseInt(Electrical_TextField.getText());
        int bioMarks = Integer.parseInt(Biology_TextField.getText());
        int total = physicsMarks + mathsMarks + chemMarks + electricalMarks + bioMarks;
        
       //NOW add all the marks to the database
        try{
            Connection con = ConnectionProviderCode.getcon();  //creating connection object
            Statement st = con.createStatement();           //creating Statement object 
            
            //Instead of adding new marks , we will update the existing marks using the roll no key  
            st.executeUpdate("UPDATE result SET physics=" + physicsMarks +" , maths="+ mathsMarks +", chemistry="+ chemMarks +", electrical="+ electricalMarks +", biology="+ bioMarks + ", total=" + total+ " where rollNo='"+ rollNo +"'");

            JOptionPane.showMessageDialog(null, "Added Successfully");
            setVisible(false);
            UpdateResult frame = new UpdateResult();
            frame.setVisible(true);
            frame.setLocationRelativeTo(null);
        }
        catch(Exception e){  //Happens when we already ahve marks for any roll No in DB but still we are updating the marks again--Duplicate entry for 'x' rollNo error
            JOptionPane.showMessageDialog(null, e.toString());
        }
    }//GEN-LAST:event_Submit_ButtonActionPerformed

    private void Exit_ButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Exit_ButtonActionPerformed
        // TODO add your handling code here:
          int response = JOptionPane.showConfirmDialog(null, "You sure you want to exit", "Submit", JOptionPane.YES_NO_OPTION);
        
        if(response == 0){
            setVisible(false);
        }
    }//GEN-LAST:event_Exit_ButtonActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(UpdateResult.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(UpdateResult.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(UpdateResult.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(UpdateResult.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new UpdateResult().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField Biology_TextField;
    private javax.swing.JTextField Chemistry_TextField;
    private javax.swing.JTextField Electrical_TextField;
    private javax.swing.JButton Exit_Button;
    private javax.swing.JTextField Maths_TextField;
    private javax.swing.JTextField Physics_TextField;
    private javax.swing.JTextField RollNo_TextField;
    private javax.swing.JButton Search_Button;
    private javax.swing.JButton Submit_Button;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    // End of variables declaration//GEN-END:variables
}
